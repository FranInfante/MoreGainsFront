<app-back-to-menu [displayText]="user?.username + ' Profile'"></app-back-to-menu>
<div class="container mt-5">
  <div class="row">
    <div class="col-md-6 order-md-1 order-2 form-container">
      <form [formGroup]="userForm" (ngSubmit)="updateUser()">
        <div class="mb-3">
          <label for="bio" class="form-label">Bio</label>
          <textarea id="bio" class="form-control" formControlName="bio" rows="3"></textarea>
        </div>
        <div class="mb-3">
          <label for="privacySetting" class="form-label">Privacy Setting</label>
          <select id="privacySetting" class="form-control" formControlName="privacySetting">
            <option *ngFor="let setting of privacySettings" [value]="setting">{{ setting }}</option>
          </select>
        </div>
        <div class="d-flex justify-content-center mb-3">
          <button type="button" class="btn btn-secondary" data-bs-toggle="modal" data-bs-target="#changePasswordModal">Change Password</button>
        </div>
        <div class="d-flex justify-content-between mb-3">
          <button type="button" class="btn btn-warning me-2 text-white" id="btn-edit" (click)="toggleEdit()" *ngIf="!isEditing">Edit</button>
          <button type="submit" class="btn btn-warning me-2 text-white" id="btn-save-change" [disabled]="!userForm.valid" *ngIf="isEditing">Save Changes</button>
          <button type="button" class="btn btn-danger margin-left-2%" id="btn-cancel-edit" *ngIf="isEditing" (click)="toggleCancel()">Cancel</button>
          <button type="button" class="btn btn-danger" data-bs-toggle="modal" data-bs-target="#deactivateModal" *ngIf="!isEditing">Deactivate Account</button>
        </div>
      </form>
    </div>
    <div class="col-md-6 order-md-2 order-1 d-flex flex-column align-items-center iconcontainer position-relative">
      <div class="profile-img-container" (mouseover)="showPlaceholder()" (mouseout)="hidePlaceholder()">
        <img [src]="userIcon" class="rounded-circle mb-3 icon-img" alt="Profile Image" data-bs-toggle="modal" data-bs-target="#uploadProfilePictureModal">
        <div class="placeholder-text" [class.show]="isPlaceholderVisible">Click to change profile picture</div>
      </div>
      <h5>{{ user?.username }}</h5>
      <p>{{ user?.email }}</p>
    </div>
  </div>
  

  <!-- Deactivate Modal -->
  <div class="modal fade" id="deactivateModal" tabindex="-1" aria-labelledby="deactivateModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="deactivateModalLabel">Confirm Deactivation</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body">
          Are you sure you want to deactivate this account?
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-warning" data-bs-dismiss="modal">Cancel</button>
          <button type="button" class="btn btn-danger" (click)="deactivateAccount()" data-bs-dismiss="modal">Deactivate</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Change Password Modal -->
  <div class="modal fade" id="changePasswordModal" tabindex="-1" aria-labelledby="changePasswordModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="changePasswordModalLabel">Change Password</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body d-flex justify-content-center">
          <form [formGroup]="passwordForm" (ngSubmit)="changePassword()" class="w-100">
            <div class="mb-3">
              <label for="newPassword" class="form-label">New Password</label>
              <input type="password" id="newPassword" class="form-control" formControlName="newPassword">
            </div>
            <div class="mb-3">
              <label for="confirmPassword" class="form-label">Confirm Password</label>
              <input type="password" id="confirmPassword" class="form-control" formControlName="confirmPassword">
            </div>
            <div *ngIf="passwordForm.errors?.['passwordMismatch']" class="text-danger">
              Passwords do not match.
            </div>
            <button type="submit" class="btn btn-primary w-100" [disabled]="!passwordForm.valid">Change Password</button>
          </form>
        </div>
      </div>
    </div>
  </div>

  <!-- Upload Profile Picture Modal -->
  <div class="modal fade" id="uploadProfilePictureModal" tabindex="-1" aria-labelledby="uploadProfilePictureModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-dialog-centered">
      <div class="modal-content">
        <div class="modal-header">
          <h5 class="modal-title" id="uploadProfilePictureModalLabel">Upload Profile Picture</h5>
          <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
        </div>
        <div class="modal-body d-flex justify-content-center">
          <form (ngSubmit)="uploadProfilePicture()" class="w-100">
            <div class="mb-3">
              <label for="profilePicture" class="form-label">Choose a profile picture</label>
              <input type="file" id="profilePicture" class="form-control" (change)="onFileSelected($event)">
            </div>
            <button type="submit" class="btn btn-primary w-100">Upload</button>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>
